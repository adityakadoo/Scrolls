<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=HandheldFriendly content="True"><meta http-equiv=x-ua-compatible content="IE=edge"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=generator content="Hugo 0.102.3"><link rel="shortcut icon" href=https://cdn.jsdelivr.net/gh/dsrkafuu/dsr-cdn-main@1/images/favicons/dsrca.ico><title>Operating Systems - Scrolls</title><meta name=keywords content="Computer-Science"><meta property="og:title" content="Operating Systems"><meta name=twitter:title content="Operating Systems"><meta property="og:type" content="article"><meta property="og:url" content="https://adityakadoo.github.io/Scrolls/courses/operating_systems/"><meta property="og:description" content="Resources Operating Systems - Three Easy Pieces Introduction to OS Main objectives of OS include:-
CPU Virtualization : Making using the processor easy. Memory Virtualization : Making storage in memory easy. Concurrency : Ensuring correctness when multiple programs run together. Persistence : Ensuring permanent memory does not get erased and stays organised. Design Goals : Abstractions, performance, isolation, reliability, energy-efficiency CPU Virtualization Abstraction : Process The abstraction provided by the OS of a running program is called a process."><meta name=twitter:description content="Resources Operating Systems - Three Easy Pieces Introduction to OS Main objectives of OS include:-
CPU Virtualization : Making using the processor easy. Memory Virtualization : Making storage in memory easy. Concurrency : Ensuring correctness when multiple programs run together. Persistence : Ensuring permanent memory does not get erased and stays organised. Design Goals : Abstractions, performance, isolation, reliability, energy-efficiency CPU Virtualization Abstraction : Process The abstraction provided by the OS of a running program is called a process."><meta name=twitter:card content="summary"><meta property="article:published_time" content="2022-08-19T10:31:05+05:30"><meta property="article:modified_time" content="2022-08-19T10:31:05+05:30"><style>@media(prefers-color-scheme:dark){body[data-theme=auto] img{filter:brightness(60%)}}body[data-theme=dark] img{filter:brightness(60%)}</style><link rel=stylesheet href=https://adityakadoo.github.io/Scrolls/assets/css/fuji.min.css></head><body data-theme=auto data-theme-auto=false><script data-cfasync=false>var fujiThemeData=localStorage.getItem("fuji_data-theme");fujiThemeData?fujiThemeData!=="auto"&&document.body.setAttribute("data-theme",fujiThemeData==="dark"?"dark":"light"):localStorage.setItem("fuji_data-theme","auto")</script><header><div class="container-lg clearfix"><div class="col-12 header"><a class=title-main href=https://adityakadoo.github.io/Scrolls/>Scrolls</a></div></div></header><main><div class="container-lg clearfix"><div class="col-12 col-md-9 float-left content"><article><h2 class="post-item post-title"><a href=https://adityakadoo.github.io/Scrolls/courses/operating_systems/>Operating Systems</a></h2><div class="post-item post-meta"><span><i class="iconfont icon-today-sharp"></i>&nbsp;2022-08-19</span>
<span><i class="iconfont icon-pricetags-sharp"></i>&nbsp;<a href=/tags/computer-science>Computer-Science</a>&nbsp;</span></div><div class="post-content markdown-body"><h2 id=resources>Resources</h2><ul><li><h3 id=operating-systems---three-easy-pieceshttpstechiefood4ufileswordpresscom202002operating_systems_three_easy_piecespdf><a href=https://techiefood4u.files.wordpress.com/2020/02/operating_systems_three_easy_pieces.pdf target=_blank>Operating Systems - Three Easy Pieces</a></h3></li></ul><h2 id=introduction-to-os>Introduction to OS</h2><p>Main objectives of OS include:-</p><ol><li><strong>CPU Virtualization</strong> : Making using the processor easy.</li><li><strong>Memory Virtualization</strong> : Making storage in memory easy.</li><li><strong>Concurrency</strong> : Ensuring correctness when multiple programs run together.</li><li><strong>Persistence</strong> : Ensuring permanent memory does not get erased and stays organised.</li><li><strong>Design Goals</strong> : Abstractions, performance, isolation, reliability, energy-efficiency</li></ol><h2 id=cpu-virtualization>CPU Virtualization</h2><h3 id=abstraction--process>Abstraction : Process</h3><p>The abstraction provided by the OS of a running program is called a <em><strong>process</strong></em>.</p><p>The OS creates the illusion of <strong>virtualization</strong> the CPU by running one process, then stopping it and running another, and so forth. This is known as <strong>time sharing</strong> of the CPU.</p><blockquote><p><strong>Time sharing</strong> is one of the most basic techniques used by an OS to share a resource. By allowing the resource to be used for a little while by one entity, and then a little while by another, and so forth. The natural counterpart of time sharing is <strong>space sharing</strong>, where a resource is divided (in space) among those who wish to use it.</p></blockquote><h4 id=process-api>Process API</h4><ul><li><strong>Create</strong>: Spawns a new process.</li><li><strong>Destroy</strong>: Kills a process forcefully.</li><li><strong>Wait</strong>: Wait for a process to finish.</li><li><strong>Status</strong>: Every process has a state associated with it.</li><li><strong>Miscellaneous Control</strong>: Halt, resume, etc.</li></ul><h4 id=process-creation>Process Creation</h4><ol><li>Loading the <em>code</em> into executable format.</li><li>Initializing the process&rsquo;s runtime <em>stack</em>.</li><li>Initializing the program&rsquo;s <em>heap</em> memory.</li><li>Setup <em>file descriptors</em> associated with <em>input</em>, <em>output</em> and <em>error</em> streams.</li></ol><h4 id=process-states>Process States</h4><p>Following are the types of states a process can be in:-</p><ul><li><strong>Running</strong></li><li><strong>Ready</strong></li><li><strong>Blocked</strong></li></ul><div class="goat svg-container"><svg xmlns="http://www.w3.org/2000/svg" font-family="Menlo,Lucida Console,monospace" viewBox="0 0 272 169"><g transform="translate(8,16)"><path d="M16 0H64" fill="none" stroke="currentcolor"/><path d="M208 0h32" fill="none" stroke="currentcolor"/><path d="M88 16h96" fill="none" stroke="currentcolor"/><path d="M88 32h96" fill="none" stroke="currentcolor"/><path d="M16 48H64" fill="none" stroke="currentcolor"/><path d="M208 48h32" fill="none" stroke="currentcolor"/><path d="M112 96h48" fill="none" stroke="currentcolor"/><path d="M72 112H88" fill="none" stroke="currentcolor"/><path d="M184 112h16" fill="none" stroke="currentcolor"/><path d="M112 144h48" fill="none" stroke="currentcolor"/><path d="M0 16V32" fill="none" stroke="currentcolor"/><path d="M80 16V32" fill="none" stroke="currentcolor"/><path d="M96 112v16" fill="none" stroke="currentcolor"/><path d="M176 112v16" fill="none" stroke="currentcolor"/><path d="M192 16V32" fill="none" stroke="currentcolor"/><path d="M256 16V32" fill="none" stroke="currentcolor"/><path d="M2e2 112l24-48" fill="none" stroke="currentcolor"/><path d="M48 64l24 48" fill="none" stroke="currentcolor"/><polygon points="96.000000,32.000000 84.000000,26.400000 84.000000,37.599998" fill="currentcolor" transform="rotate(180.000000, 88.000000, 32.000000)"/><polygon points="96.000000,112.000000 84.000000,106.400002 84.000000,117.599998" fill="currentcolor" transform="rotate(0.000000, 88.000000, 112.000000)"/><polygon points="192.000000,16.000000 180.000000,10.400000 180.000000,21.600000" fill="currentcolor" transform="rotate(0.000000, 184.000000, 16.000000)"/><polygon points="192.000000,112.000000 180.000000,106.400002 180.000000,117.599998" fill="currentcolor" transform="rotate(180.000000, 184.000000, 112.000000)"/><path d="M16 0A16 16 0 000 16" fill="none" stroke="currentcolor"/><path d="M64 0A16 16 0 0180 16" fill="none" stroke="currentcolor"/><path d="M208 0A16 16 0 00192 16" fill="none" stroke="currentcolor"/><path d="M240 0a16 16 0 0116 16" fill="none" stroke="currentcolor"/><path d="M0 32A16 16 0 0016 48" fill="none" stroke="currentcolor"/><path d="M80 32A16 16 0 0164 48" fill="none" stroke="currentcolor"/><path d="M192 32a16 16 0 0016 16" fill="none" stroke="currentcolor"/><path d="M256 32A16 16 0 01240 48" fill="none" stroke="currentcolor"/><path d="M112 96A16 16 0 0096 112" fill="none" stroke="currentcolor"/><path d="M160 96a16 16 0 0116 16" fill="none" stroke="currentcolor"/><path d="M96 128a16 16 0 0016 16" fill="none" stroke="currentcolor"/><path d="M176 128a16 16 0 01-16 16" fill="none" stroke="currentcolor"/><text text-anchor="middle" x="16" y="20" fill="currentcolor" style="font-size:1em">R</text><text text-anchor="middle" x="16" y="84" fill="currentcolor" style="font-size:1em">I</text><text text-anchor="middle" x="16" y="100" fill="currentcolor" style="font-size:1em">s</text><text text-anchor="middle" x="24" y="20" fill="currentcolor" style="font-size:1em">u</text><text text-anchor="middle" x="24" y="36" fill="currentcolor" style="font-size:1em">s</text><text text-anchor="middle" x="24" y="84" fill="currentcolor" style="font-size:1em">/</text><text text-anchor="middle" x="24" y="100" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="32" y="20" fill="currentcolor" style="font-size:1em">n</text><text text-anchor="middle" x="32" y="36" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="32" y="84" fill="currentcolor" style="font-size:1em">O</text><text text-anchor="middle" x="32" y="100" fill="currentcolor" style="font-size:1em">a</text><text text-anchor="middle" x="40" y="20" fill="currentcolor" style="font-size:1em">n</text><text text-anchor="middle" x="40" y="36" fill="currentcolor" style="font-size:1em">a</text><text text-anchor="middle" x="40" y="84" fill="currentcolor" style="font-size:1em">:</text><text text-anchor="middle" x="40" y="100" fill="currentcolor" style="font-size:1em">r</text><text text-anchor="middle" x="48" y="20" fill="currentcolor" style="font-size:1em">i</text><text text-anchor="middle" x="48" y="36" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="48" y="100" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="56" y="20" fill="currentcolor" style="font-size:1em">n</text><text text-anchor="middle" x="56" y="36" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="64" y="20" fill="currentcolor" style="font-size:1em">g</text><text text-anchor="middle" x="96" y="4" fill="currentcolor" style="font-size:1em">D</text><text text-anchor="middle" x="104" y="4" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="104" y="52" fill="currentcolor" style="font-size:1em">S</text><text text-anchor="middle" x="112" y="4" fill="currentcolor" style="font-size:1em">s</text><text text-anchor="middle" x="112" y="52" fill="currentcolor" style="font-size:1em">c</text><text text-anchor="middle" x="112" y="116" fill="currentcolor" style="font-size:1em">B</text><text text-anchor="middle" x="120" y="4" fill="currentcolor" style="font-size:1em">c</text><text text-anchor="middle" x="120" y="52" fill="currentcolor" style="font-size:1em">h</text><text text-anchor="middle" x="120" y="116" fill="currentcolor" style="font-size:1em">l</text><text text-anchor="middle" x="120" y="132" fill="currentcolor" style="font-size:1em">s</text><text text-anchor="middle" x="128" y="4" fill="currentcolor" style="font-size:1em">h</text><text text-anchor="middle" x="128" y="52" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="128" y="116" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="128" y="132" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="136" y="4" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="136" y="52" fill="currentcolor" style="font-size:1em">d</text><text text-anchor="middle" x="136" y="116" fill="currentcolor" style="font-size:1em">c</text><text text-anchor="middle" x="136" y="132" fill="currentcolor" style="font-size:1em">a</text><text text-anchor="middle" x="144" y="4" fill="currentcolor" style="font-size:1em">d</text><text text-anchor="middle" x="144" y="52" fill="currentcolor" style="font-size:1em">u</text><text text-anchor="middle" x="144" y="116" fill="currentcolor" style="font-size:1em">k</text><text text-anchor="middle" x="144" y="132" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="152" y="4" fill="currentcolor" style="font-size:1em">u</text><text text-anchor="middle" x="152" y="52" fill="currentcolor" style="font-size:1em">l</text><text text-anchor="middle" x="152" y="116" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="152" y="132" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="160" y="4" fill="currentcolor" style="font-size:1em">l</text><text text-anchor="middle" x="160" y="52" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="160" y="116" fill="currentcolor" style="font-size:1em">d</text><text text-anchor="middle" x="168" y="4" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="168" y="52" fill="currentcolor" style="font-size:1em">d</text><text text-anchor="middle" x="176" y="4" fill="currentcolor" style="font-size:1em">d</text><text text-anchor="middle" x="208" y="20" fill="currentcolor" style="font-size:1em">R</text><text text-anchor="middle" x="208" y="36" fill="currentcolor" style="font-size:1em">s</text><text text-anchor="middle" x="216" y="20" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="216" y="36" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="224" y="20" fill="currentcolor" style="font-size:1em">a</text><text text-anchor="middle" x="224" y="36" fill="currentcolor" style="font-size:1em">a</text><text text-anchor="middle" x="232" y="20" fill="currentcolor" style="font-size:1em">d</text><text text-anchor="middle" x="232" y="36" fill="currentcolor" style="font-size:1em">t</text><text text-anchor="middle" x="232" y="84" fill="currentcolor" style="font-size:1em">I</text><text text-anchor="middle" x="232" y="100" fill="currentcolor" style="font-size:1em">d</text><text text-anchor="middle" x="240" y="20" fill="currentcolor" style="font-size:1em">y</text><text text-anchor="middle" x="240" y="36" fill="currentcolor" style="font-size:1em">e</text><text text-anchor="middle" x="240" y="84" fill="currentcolor" style="font-size:1em">/</text><text text-anchor="middle" x="240" y="100" fill="currentcolor" style="font-size:1em">o</text><text text-anchor="middle" x="248" y="84" fill="currentcolor" style="font-size:1em">O</text><text text-anchor="middle" x="248" y="100" fill="currentcolor" style="font-size:1em">n</text><text text-anchor="middle" x="256" y="84" fill="currentcolor" style="font-size:1em">:</text><text text-anchor="middle" x="256" y="100" fill="currentcolor" style="font-size:1em">e</text></g></svg></div><h4 id=data-structures>Data Structures</h4><ul><li><strong>Process List</strong>: A list maintained by the OS of all the processes and their PCB.</li><li><strong>Process Control Block</strong> (PCB): A C struct that keeps track of all the meta-data associated with one process.</li></ul><h3 id=process-api-1>Process API</h3><p>In UNIX systems new processes are created with the use of 2 system calls <code>fork()</code> and <code>exec()</code>.</p><h4 id=fork-system-call><code>fork()</code> system call</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(){
</span></span><span style=display:flex><span>    printf(<span style=color:#e6db74>&#34;%d:hello world.&#34;</span>,getpid());
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> rc <span style=color:#f92672>=</span> fork();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (rc<span style=color:#f92672>&lt;</span><span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// fork failed
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        fprintf(stderr, <span style=color:#e6db74>&#34;fork failed</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (rc <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// only executed by child
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        printf(<span style=color:#e6db74>&#34;%d:hello, I am child.</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>,getpid());
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// only executed by parent
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        printf(<span style=color:#e6db74>&#34;%d:hello, I am parent of %d.</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, getpid(), rc);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=adding-wait-system-call>Adding <code>wait()</code> system call</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(){
</span></span><span style=display:flex><span>    printf(<span style=color:#e6db74>&#34;%d:hello world.&#34;</span>,getpid());
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> rc <span style=color:#f92672>=</span> fork();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (rc<span style=color:#f92672>&lt;</span><span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// fork failed
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        fprintf(stderr, <span style=color:#e6db74>&#34;fork failed</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (rc <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// only executed by child
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        printf(<span style=color:#e6db74>&#34;%d:hello, I am child.</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>,getpid());
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// only executed by parent
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// after waiting for child
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>while</span>(wait(NULL)<span style=color:#f92672>&gt;</span><span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>        printf(<span style=color:#e6db74>&#34;%d:hello, I am parent of %d.</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, getpid(), rc);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=finally-the-exec-system-call>Finally, the <code>exec()</code> system call</h4><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>int</span> <span style=color:#a6e22e>main</span>(){
</span></span><span style=display:flex><span>    printf(<span style=color:#e6db74>&#34;%d:hello world.&#34;</span>,getpid());
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> rc <span style=color:#f92672>=</span> fork();
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> (rc<span style=color:#f92672>&lt;</span><span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// fork failed
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        fprintf(stderr, <span style=color:#e6db74>&#34;fork failed</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> <span style=color:#66d9ef>if</span> (rc <span style=color:#f92672>==</span> <span style=color:#ae81ff>0</span>) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// only executed by child
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        printf(<span style=color:#e6db74>&#34;%d:hello, I am child.</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>,getpid());
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>char</span> <span style=color:#f92672>*</span>myargs[<span style=color:#ae81ff>3</span>];
</span></span><span style=display:flex><span>        myargs[<span style=color:#ae81ff>0</span>] <span style=color:#f92672>=</span> strdup(<span style=color:#e6db74>&#34;wc&#34;</span>);
</span></span><span style=display:flex><span>        myargs[<span style=color:#ae81ff>1</span>] <span style=color:#f92672>=</span> strdup(<span style=color:#e6db74>&#34;p3.c&#34;</span>);
</span></span><span style=display:flex><span>        myargs[<span style=color:#ae81ff>2</span>] <span style=color:#f92672>=</span> NULL;
</span></span><span style=display:flex><span>        execvp(myargs[<span style=color:#ae81ff>0</span>], myargs);
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Child converted to a different program now
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        printf(<span style=color:#e6db74>&#34;somethings wrong; I can feel it</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>);
</span></span><span style=display:flex><span>    } <span style=color:#66d9ef>else</span> {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// only executed by parent
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#75715e>// after waiting for child
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>while</span>(wait(NULL)<span style=color:#f92672>&gt;</span><span style=color:#ae81ff>0</span>);
</span></span><span style=display:flex><span>        printf(<span style=color:#e6db74>&#34;%d:hello, I am parent of %d.</span><span style=color:#ae81ff>\n</span><span style=color:#e6db74>&#34;</span>, getpid(), rc);
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h3 id=limited-direct-execution>Limited Direct Execution</h3><p>Direct Execution can be explained by the following table,</p><table><thead><tr><th>OS</th><th>Program</th></tr></thead><tbody><tr><td>Create entry for process list</td><td></td></tr><tr><td>Allocate memory to program</td><td></td></tr><tr><td>Load program into memory</td><td></td></tr><tr><td>Set up stack with argc/argv</td><td></td></tr><tr><td>Clear registers</td><td></td></tr><tr><td>Execute call <code>main()</code></td><td></td></tr><tr><td></td><td>Run <code>main()</code></td></tr><tr><td></td><td>Execute return from <code>main()</code></td></tr><tr><td>Free memory of process</td><td></td></tr><tr><td>Remove from process list</td><td></td></tr></tbody></table><h4 id=problem-1-restricted-operations>Problem #1: Restricted Operations</h4><blockquote><p>How to perform restricted operations such as I/O or networking without giveing complete control over the system?</p></blockquote><p>We add processor modes:-</p><ul><li><em><strong>User mode</strong></em>: The code that runs here is restricted and can&rsquo;t issue I/O requests and it will kill the process.</li><li><em><strong>Kernel mode</strong></em>: In this mode the operating system runs the code and can do whatever it likes.</li></ul><blockquote><p>What should a user program do to perform some kind of privileged operation?</p></blockquote><p>The answer is <em><strong>system calls</strong></em>.</p><p>Every system call runs a special <code>trap</code> instruction which jumps the execution to kernel mode to do any privileged operation. Once finished the program can return to user mode by executing <code>return-from-trap</code> instruction.</p><p>While executing <code>trap</code>, the hardware needs to ensure the register state of the user program is stored and must be restored when <code>return-from-trap</code> is executed.</p><blockquote><p>How does the trap know which code to run inside the OS?</p></blockquote><p>The kernel sets-up a <strong>trap table</strong> at boot time in priviledged mode. OS informs the hardware of the locations of the <strong>trap handlers</strong>. Using this, whenever a hardware interrupt is
passed this code is run by the hardware from the trap handlers.
All these operation are also <strong>priviledge</strong> operations.</p><table><thead><tr><th>OS</th><th>Hardware</th><th>Program</th></tr></thead><tbody><tr><td>Initialize trap table</td><td>Remember addresses of syscall handler</td><td></td></tr><tr><td>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&ndash;</td><td>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</td><td>&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;&mdash;</td></tr><tr><td>Create entry for process list</td><td></td><td></td></tr><tr><td>Allocate memory to program</td><td></td><td></td></tr><tr><td>Load program into memory</td><td></td><td></td></tr><tr><td>Set up stack with argc/argv</td><td></td><td></td></tr><tr><td>Clear registers</td><td></td><td></td></tr><tr><td><code>return-from-trap</code></td><td></td><td></td></tr><tr><td></td><td>restores regs to kernel stack</td><td></td></tr><tr><td></td><td>move to user mode</td><td></td></tr><tr><td></td><td>jump to <code>main()</code></td><td></td></tr><tr><td></td><td></td><td>Run <code>main()</code></td></tr><tr><td></td><td></td><td>Call syscall</td></tr><tr><td></td><td></td><td><code>trap</code> into OS</td></tr><tr><td></td><td>save regs to kernel stack</td><td></td></tr><tr><td></td><td>move to kernel mode</td><td></td></tr><tr><td></td><td>jump to trap handler</td><td></td></tr><tr><td>Handle trap</td><td></td><td></td></tr><tr><td>Execute system call</td><td></td><td></td></tr><tr><td><code>return-from-trap</code></td><td></td><td></td></tr><tr><td></td><td>restore regs from kernel stack</td><td></td></tr><tr><td></td><td>move to kernel mode</td><td></td></tr><tr><td></td><td>jump to PC after trap</td><td></td></tr><tr><td></td><td></td><td>return from main</td></tr><tr><td></td><td></td><td><code>trap</code> via <code>exit()</code></td></tr><tr><td>Free memory of process</td><td></td><td></td></tr><tr><td>Remove from process list</td><td></td><td></td></tr></tbody></table><h3 id=switching-between-process>Switching Between Process</h3><blockquote><p>How can the operating system <strong>regain control</strong> of the CPU so that it can switch process?</p></blockquote><ul><li><em><strong>Wait for system calls</strong></em>: When ever the user program makes system call or makes an error it returns the control back to the OS. Otherwise it can also make a <code>yield</code> call to return the control to the OS periodically.</li><li><em><strong>OS takes controls</strong></em>: This can be done using a simple <code>timer interrupt</code> that is raised after a fixed amount milliseconds.</li></ul><h4 id=saving-and-restoring-context>Saving and Restoring Context</h4><blockquote><p>Once the OS gains control, how to decide which process gets executed next?</p></blockquote><p>This is done by the <strong>scheduler</strong>. Once the decision is made the OS executes a low-level piece of code which is called <strong>context switch</strong>. It is basically saving the register values of the current process and restoring the same for the next process.</p><h2 id=memory-virtualization>Memory Virtualization</h2><h3 id=abstraction--address-spaces>Abstraction : Address Spaces</h3><p><img class=img-zoomable src=images/address_space.png alt="Address space example"></p><p>3 regions of code in the address space:-</p><ul><li>Code: Keeps the data related to the code</li><li>Stack: Keeps track of the function calls and scope variables</li><li>Heap: Holds the dynamically allocated memory</li></ul><p>Objectives of Memory virtualization:-</p><ul><li>Transparency</li><li>Efficiency</li><li>Protection/Isolation</li></ul><h3 id=memory-api>Memory API</h3><h4 id=automaticstack-memory>Automatic/Stack Memory</h4><p>This is the memory that is accessed when using a variable on <strong>stack</strong>. This is temporary and is overwritten when the variable goes out of scope</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>func</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> x; <span style=color:#75715e>// declares an integer on the stack
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    ...
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><h4 id=heap-memory>Heap Memory</h4><p>This is a long-lived memory which is handled explicitly by the programmer.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-c data-lang=c><span style=display:flex><span><span style=color:#66d9ef>void</span> <span style=color:#a6e22e>func</span>() {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>int</span> <span style=color:#f92672>*</span>x <span style=color:#f92672>=</span> (<span style=color:#66d9ef>int</span> <span style=color:#f92672>*</span>) malloc(<span style=color:#66d9ef>sizeof</span>(<span style=color:#66d9ef>int</span>)); <span style=color:#75715e>// allocates memory on heap
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    ...
</span></span><span style=display:flex><span>    free(x); <span style=color:#75715e>// frees the allocated memory
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>}
</span></span></code></pre></div><blockquote><p><code>malloc()</code> and <code>free()</code> are not system calls but library calls built on top of system calls. Apart from these there is <code>calloc()</code> and <code>realloc()</code>.</p></blockquote><blockquote><p><code>mmap()</code> is another call to get <strong>anonymous</strong> memory allocated in the swap space.</p></blockquote><h3 id=address-translation>Address Translation</h3><p>The hardware provides a generic technique called <strong>hardware-based address translation</strong> to map virtual addresses to physical address but this is quite low-level and the OS has to step-in and manage which areas are free.</p><p>We assume that:</p><ul><li>Address space must be mapped to <em>contiguous</em> physical memory</li><li>The physical space is large compared to the address space</li><li>All address spaces are of exactly same size</li></ul><p>This is done at runtime by the <strong>Memory Management Unit(MMU)</strong> in the CPU. The hardware maintains a <strong>base</strong> and a <strong>bound</strong> to keep track of where an address space is mapped. If memory outside this is accessed CPU raises a segmentation fault.</p><p>OS thus has to maintain the location of memory not in use in a data structure such as <strong>free list</strong>.</p><h3 id=segmentation>Segmentation</h3><p>Instead of keeping track of base and bound pair of the entire address space as this wastes a lot of used space, store base and bound of different segments such as the code, stack and heap. Along with their seperate bounds also keep track of direction in which it grows and it&rsquo;s read/write permissions.</p><h4 id=os-issues>OS issues</h4><ol><li><em><strong>Context Switch</strong></em>: During a context switch the OS needs to make sure the addresses corresponding to all the segments of the address space are stored.</li><li><em><strong>External Fragmentation</strong></em>: This happens when the spaces left in between allocated segments is not enough to store a new segment but the total free space is sufficient to do so.</li></ol><h3 id=free-space-management>Free Space Management</h3><h4 id=free-list-approach>Free List Approach</h4><p>Using a linked list to keep track of free unallocated segments of memory. Every node stores the start and size of the free segment. When new segements are to be allocated find a node with enough space and shrink it to account for newly occupied memory. Later when a segment is freed, collase joined node together.</p><h4 id=some-allocation-strategies>Some allocation strategies</h4><ul><li>Best fit: node with min size greater than required.</li><li>Worst fit: node with max size greater than required. Basically largest node.</li><li>First fit: first node greater than required. Greedy but fast.</li><li>Next fit: Instead of searching from the start search from the next node of last allocation.</li></ul><h4 id=other-approaches>Other Approaches</h4><ul><li>Segregated Allocator: Keeps a region of memory to allocate the most segments with the most frequent size and a separate block to keep segments with other sizes.</li><li>Buddy Allocator: Only divides free segments in half. Simplifies the coallesing part.</li></ul></div></article></div><aside class="col-12 col-md-3 float-left sidebar"><div class="sidebar-item sidebar-pages"><h3>Pages</h3><ul></ul></div><div class="sidebar-item sidebar-links"><h3>Links</h3><ul></ul></div><div class="sidebar-item sidebar-tags"><h3>Tags</h3><div><span><a href=/Scrolls/tags/computer-science/>Computer-Science</a></span>
<span><a href=/Scrolls/tags/machine-learning/>Machine-Learning</a></span>
<span><a href=/Scrolls/tags/math/>Math</a></span>
<span><a href=/Scrolls/tags/programming-languages/>Programming-Languages</a></span></div></div><div class="sidebar-item sidebar-toc"><h3>Table of Contents</h3><nav id=TableOfContents><ul><li><a href=#resources>Resources</a><ul><li><a href=#operating-systems---three-easy-pieceshttpstechiefood4ufileswordpresscom202002operating_systems_three_easy_piecespdf><a href=https://techiefood4u.files.wordpress.com/2020/02/operating_systems_three_easy_pieces.pdf>Operating Systems - Three Easy Pieces</a></a></li></ul></li><li><a href=#introduction-to-os>Introduction to OS</a></li><li><a href=#cpu-virtualization>CPU Virtualization</a><ul><li><a href=#abstraction--process>Abstraction : Process</a></li><li><a href=#process-api-1>Process API</a></li><li><a href=#limited-direct-execution>Limited Direct Execution</a></li><li><a href=#switching-between-process>Switching Between Process</a></li></ul></li><li><a href=#memory-virtualization>Memory Virtualization</a><ul><li><a href=#abstraction--address-spaces>Abstraction : Address Spaces</a></li><li><a href=#memory-api>Memory API</a></li><li><a href=#address-translation>Address Translation</a></li><li><a href=#segmentation>Segmentation</a></li><li><a href=#free-space-management>Free Space Management</a></li></ul></li></ul></nav></div></aside></div><div class=btn><div class=btn-menu id=btn-menu><i class="iconfont icon-grid-sharp"></i></div><div class=btn-toggle-mode><i class="iconfont icon-contrast-sharp"></i></div><div class=btn-scroll-top><i class="iconfont icon-chevron-up-circle-sharp"></i></div></div><aside class=sidebar-mobile style=display:none><div class=sidebar-wrapper><div class="sidebar-item sidebar-pages"><h3>Pages</h3><ul></ul></div><div class="sidebar-item sidebar-links"><h3>Links</h3><ul></ul></div><div class="sidebar-item sidebar-tags"><h3>Tags</h3><div><span><a href=/Scrolls/tags/computer-science/>Computer-Science</a></span>
<span><a href=/Scrolls/tags/machine-learning/>Machine-Learning</a></span>
<span><a href=/Scrolls/tags/math/>Math</a></span>
<span><a href=/Scrolls/tags/programming-languages/>Programming-Languages</a></span></div></div></div></aside></main><footer><div class="container-lg clearfix"><div class="col-12 footer"><span>&copy; 2022
<a href=https://adityakadoo.github.io/Scrolls/></a>
| Powered by <a href=https://github.com/dsrkafuu/hugo-theme-fuji/ target=_blank>Fuji-v2</a> & <a href=https://gohugo.io/ target=_blank>Hugo</a></span></div></div></footer><script defer src=https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js></script>
<script defer src=https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js></script>
<script defer src=https://cdn.jsdelivr.net/npm/prismjs@1.27.0/components/prism-core.min.js></script>
<script defer src=https://cdn.jsdelivr.net/npm/prismjs@1.27.0/plugins/autoloader/prism-autoloader.min.js></script>
<script defer src=/Scrolls/assets/js/fuji.min.js></script></body></html>